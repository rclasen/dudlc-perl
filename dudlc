#!/usr/bin/perl -w

use strict;
use warnings;

use AnyEvent::Loop;
use AnyEvent::Dudlc;
use Data::Dumper;

my $dudl = AnyEvent::Dudlc->new(
	host		=> 'localhost',
	user		=> 'lirc',
	pass		=> 'lirc',
	on_connected	=> sub {
		my( $self ) = @_;
		my( $p, $h ) = $self->getsockname;
		print STDERR "connected from $h:$p\n";
	},
	on_authenticated	=> sub {
		print STDERR "authenticated\n";
	},
	on_error	=> sub {
		print STDERR "error: @_\n";
	},
	on_disconnect	=> sub {
		print STDERR "disconnected\n";
	},
	on_status	=> sub {
		print "status: @_\n";
	},
	on_filter	=> sub {
		print "filter: @_\n";
	},
	on_track	=> sub {
		print "track: TODO\n";
	},
);

my $a = AnyEvent->timer(
	after	=> 5,
	cb	=> sub {
		print STDERR "timer\n";
		$dudl->sfilterlist( sub {
			print Dumper(@_);
		});
		$dudl->filterset( 'tag="hot"', sub {
			print "filterset: @_\n";
			$dudl->filter( sub{
				print "filter: @_\n";
			});
		});
	},
);
#my $b = AnyEvent->timer(
#	after	=> 20,
#	cb	=> sub { $dudl->pause },
#);
#

AnyEvent::Loop::run;

